<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>zkC.R.E.A.M docs</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="01-about.html"><strong aria-hidden="true">1.</strong> About</a></li><li class="chapter-item expanded "><a href="02-quick_start.html"><strong aria-hidden="true">2.</strong> Quick start</a></li><li class="chapter-item expanded "><a href="03-usage.html"><strong aria-hidden="true">3.</strong> Usage</a></li><li class="chapter-item expanded "><a href="04-circuits.html"><strong aria-hidden="true">4.</strong> Circuits</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="04-01-hasher.html"><strong aria-hidden="true">4.1.</strong> Hasher</a></li><li class="chapter-item expanded "><a href="04-02-merkleTree.html"><strong aria-hidden="true">4.2.</strong> MerkleTree</a></li><li class="chapter-item expanded "><a href="04-03-vote.html"><strong aria-hidden="true">4.3.</strong> Vote</a></li></ol></li><li class="chapter-item expanded "><a href="05-contract_api.html"><strong aria-hidden="true">5.</strong> Contract API</a></li><li class="chapter-item expanded "><a href="06-libcream.html"><strong aria-hidden="true">6.</strong> libcream</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">zkC.R.E.A.M docs</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        <a href="https://github.com/zkcream/docs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#about" id="about">About</a></h1>
<p><strong><a href="https://github.com/couger-inc/cream">zkC.R.E.A.M</a></strong> stands for <strong>Confidential Reliable Ethereum Anonymous Mixer</strong>. It is a protocol being developed as part of a pilot program to develop a more robust, accessible, secure, anonymous and verifiable voting technology for elections and other situations that require voting.</p>
<p>The protocol consists of a smart contract and a zero-knowledge component. The zkC.R.E.A.M smart contract handles the validation of voting status, permissions and proofs on-chain. The zero-knowledge component works off-chain, allowing the user to generate proofs, and if these proofs are valid, the smart contract can update the state.</p>
<h2><a class="header" href="#system-design" id="system-design">System design</a></h2>
<p>zkC.R.E.A.M aims to be simple in design, with the basic functions being &quot;deposit&quot; which means reception of the token used in the vote, and &quot;drawer&quot; which means casting the vote. </p>
<p>To ensure the secrecy of the vote, the voter generates a random value on their device when they make a deposit. Anyone who knows this random value can withdraw it, making the source of the token (i.e. the address where the deposit was made) secret.</p>
<h3><a class="header" href="#basic-features" id="basic-features">Basic features</a></h3>
<p>Here's what you'll need to do to set it up in a nutshell:</p>
<ol>
<li>Set the required deposit amount.</li>
<li>Set the recipients' (candidates') ethereum addresses.</li>
</ol>
<p>All other election-specific parameters are automatically passed to the constructor at contract deployment time. You can check out the configuration in the source code <a href="https://github.com/couger-inc/cream/blob/master/config/test.yml">here</a>.</p>
<h1><a class="header" href="#quick-start" id="quick-start">Quick start</a></h1>
<p>This page is basically ported from <a href="https://github.com/couger-inc/cream">README.md</a>.</p>
<p><a href="https://github.com/couger-inc/cream/actions"><img src="https://github.com/couger-inc/cream/workflows/cream%20contract%20test/badge.svg" alt="Actions Status" /></a></p>
<h2><a class="header" href="#requirement" id="requirement">Requirement</a></h2>
<ul>
<li><code>node</code> &gt;=v11.x &lt;=v12.x</li>
</ul>
<h2><a class="header" href="#setup" id="setup">Setup</a></h2>
<h3><a class="header" href="#config-file" id="config-file">Config file</a></h3>
<p>Check out the <a href="https://github.com/couger-inc/cream/blob/master/config/test.yml">config/test.yml</a> file for how to configure the settings:</p>
<pre><code class="language-yml">cream:
  merkleTrees: 4
  denomination: 1000000000000000000
  recipients: [
    &quot;0x65A5B0f4eD2170Abe0158865E04C4FF24827c529&quot;,
    &quot;0x9cc9C78eDA7c7940f968eF9D8A90653C47CD2a5e&quot;,
    &quot;0xb97796F8497bb84C63e650E9527Be587F18c09f8&quot;
  ]
  zeroValue: &quot;2558267815324835836571784235309882327407732303445109280607932348234378166811&quot;
</code></pre>
<h3><a class="header" href="#circuit" id="circuit">Circuit</a></h3>
<p>Make sure you set the same value of merkleTrees depth on both <a href="https://github.com/couger-inc/cream/blob/master/config/test.yml">config/test.yml</a> and <a href="https://github.com/couger-inc/cream/blob/master/circuits/circom/vote.circom">circuits/circom.circom</a>.</p>
<p>After you finish setting the configuration, you can run:</p>
<pre><code class="language-bash">
$ npm run bootstrap &amp;&amp; \
$ npm run build
$ ganache-cli // or cd contracts &amp;&amp; npm run ganache

# In up another terminal
$ cd contracts &amp;&amp; npm run migrate
</code></pre>
<h2><a class="header" href="#test" id="test">Test</a></h2>
<pre><code class="language-bash"># after finished setting:
$ npm run test
</code></pre>
<p>If you get an error after <code>npm run test</code> (probably on node version <code>&lt;=10.x</code>), such as <code>Error: Cannot find module 'worker_threads'</code>, please run the following command.</p>
<pre><code class="language-bash">$ export NODE_OPTIONS=--experimental-worker
</code></pre>
<h1><a class="header" href="#usage" id="usage">Usage</a></h1>
<h2><a class="header" href="#simple-anonymous-voting" id="simple-anonymous-voting">Simple anonymous voting</a></h2>
<p>Let's take a simple vote as an example.</p>
<h3><a class="header" href="#configurations" id="configurations">Configurations</a></h3>
<p>The following are the minimum settings needed to deploy the contract and use zkC.R.E.A.M.</p>
<pre><code class="language-yaml">cream:
  merkleTrees: 4
  denomination: 1000000000000000000
  recipients: [
    &quot;0x65A5B0f4eD2170Abe0158865E04C4FF24827c529&quot;,
    &quot;0x9cc9C78eDA7c7940f968eF9D8A90653C47CD2a5e&quot;,
    &quot;0xb97796F8497bb84C63e650E9527Be587F18c09f8&quot;
  ]
  zeroValue: &quot;2558267815324835836571784235309882327407732303445109280607932348234378166811&quot;
</code></pre>
<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody>
<tr><td><code>merkleTree</code></td><td>Specify the size of the merkle tree for managing the history of deposits. The size of the tree is <code>2**N</code>.</td></tr>
<tr><td><code>denomination</code></td><td>The total amount of tokens needed for the <code>deposit()</code> function call.</td></tr>
<tr><td><code>recipients</code></td><td>An array of ethereum addresses to be candidates for the ballot.</td></tr>
<tr><td><code>zeroValue</code></td><td>Zero value which defined at <code>Cream.sol</code>. It is pre-calculated as <code>uint256(keccak256(abi.encodePacked('cream'))) % FIELD_SIZE</code>.</td></tr>
</tbody></table>
<h3><a class="header" href="#deposit" id="deposit">Deposit</a></h3>
<p>The implementation of deposits is described in detail in the <a href="./05-contract_api.html#deposit">#Deposit</a> section of the Contract API.</p>
<h3><a class="header" href="#withdraw" id="withdraw">Withdraw</a></h3>
<p>The implementation of withdrawal is described in detail in the <a href="./05-contract_api.html#withdraw">#Withdraw</a> section of the Contract API.</p>
<h1><a class="header" href="#circuits" id="circuits">Circuits</a></h1>
<p>zkC.R.E.A.M. uses four different circuits, and the detailed APIs of each circuit are described in the links below:</p>
<ol>
<li><a href="04-01-hasher.html">Hasher</a></li>
<li><a href="04-02-merkleTree.html">MerkleTree</a></li>
<li><a href="04-03-vote.html">Vote</a></li>
</ol>
<h1><a class="header" href="#hasher-circuit" id="hasher-circuit">Hasher circuit</a></h1>
<p>The hasher circuit computes the Pedersen hash value of the given inputs.</p>
<h2><a class="header" href="#inputs" id="inputs">Inputs</a></h2>
<p>Both <code>nullifier</code> and <code>secret</code> values are generated when a user deposits a token into a voting contract.</p>
<table><thead><tr><th>Pseudocode name</th><th>zk-SNARK input type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>nullifier</code></td><td>Public</td><td>A random <code>ğ‘˜</code> value such that <code>ğ‘˜ âˆˆ ğ”¹248</code>.</td></tr>
<tr><td><code>secret</code></td><td>Public</td><td>A random <code>ğ‘Ÿ</code> value generated such that <code>ğ‘Ÿ âˆˆ ğ”¹248</code>.</td></tr>
</tbody></table>
<h2><a class="header" href="#outputs" id="outputs">Outputs</a></h2>
<p>The outputs of the Hasher circuit are computed outputs of hash function <code>ğ˜1</code> such that <code>ğ˜1:ğ”¹ â†’ â„¤p</code>. </p>
<p>Let <code>ğ˜1</code> be the Pedersen hash function which is imported from <code>circomlib</code> library <a href="https://github.com/iden3/circomlib/blob/master/circuits/pedersen.circom">here</a>.</p>
<table><thead><tr><th>Pesudocode name</th><th>zk-SNARK input type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>commitment</code></td><td>Public</td><td>A value <code>ğ¶</code> such that <code>ğ¶ = ğ˜1(ğ‘˜âˆ¥ğ‘Ÿ)</code>.</td></tr>
<tr><td><code>nullifierHash</code></td><td>Public</td><td>A value <code>â„</code> output of <code>â„ = ğ˜1(ğ‘˜)</code>.</td></tr>
</tbody></table>
<h1><a class="header" href="#merkle-tree-circuit" id="merkle-tree-circuit">Merkle Tree circuit</a></h1>
<h2><a class="header" href="#inputs-1" id="inputs-1">Inputs</a></h2>
<p>Let <code>ğ‘‚(ğœ, ğœ„)</code> be the path of the merkle tree <code>ğœ</code> represented by the root hash <code>ğ‘…</code> with the index <code>ğœ„</code>.</p>
<table><thead><tr><th>Pseudocode name</th><th>zk-SNARK input type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>leaf</code></td><td>Public</td><td>An output of Pedersen hash function <code>ğ¶</code> such that <code>ğ¶ = ğ˜1(ğ‘˜âˆ¥ğ‘Ÿ)</code></td></tr>
<tr><td><code>path_elements[levels]</code></td><td>Public</td><td>Path elements to prove the existence of the current leaf represented by<code>ğ‘‚(ğœ, ğœ„)</code>.</td></tr>
<tr><td><code>path_index[levels]</code></td><td>Public</td><td>A path index <code>ğœ„</code> from the merkle tree.</td></tr>
</tbody></table>
<h2><a class="header" href="#outputs-1" id="outputs-1">Outputs</a></h2>
<table><thead><tr><th>Pseudocode name</th><th>zk-SNARK input type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>root</code></td><td>Public</td><td>A value of current merkle root <code>ğ‘…</code>.</td></tr>
</tbody></table>
<h1><a class="header" href="#vote" id="vote">Vote</a></h1>
<h2><a class="header" href="#inputs-2" id="inputs-2">Inputs</a></h2>
<table><thead><tr><th>Pseudocode name</th><th>zk-SNARK input type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>root</code></td><td>Public</td><td>A merkle root of the tree.</td></tr>
<tr><td><code>nullifierHash</code></td><td>Public</td><td>A value â„ output of <code>â„ = ğ˜1(ğ‘˜)</code>.</td></tr>
<tr><td><code>nullifier</code></td><td>Private</td><td>A private known <code>ğ‘˜</code> value at the time of deposit.</td></tr>
<tr><td><code>secret</code></td><td>Private</td><td>A private known <code>ğ‘Ÿ</code> value at the time of deposit.</td></tr>
<tr><td><code>path_elements[levels]</code></td><td>Private</td><td>Private path elements to prove the existence of the current leaf represented by <code>ğ‘‚(ğœ, ğœ„)</code> at the time of deposit.</td></tr>
<tr><td><code>path_index[levels]</code></td><td>Private</td><td>A private path index <code>ğœ„</code> from merkle tree at the time of deposit.</td></tr>
<tr><td><code>recipient</code></td><td>Public</td><td>A recipient ethereum address.</td></tr>
<tr><td><code>relayer</code></td><td>Public</td><td>A relayer ethereum address. (optional)</td></tr>
<tr><td><code>fee</code></td><td>Public</td><td>A relayer fee. (optional)</td></tr>
</tbody></table>
<h2><a class="header" href="#outputs-2" id="outputs-2">Outputs</a></h2>
<table><thead><tr><th>Pseudocode name</th><th>zk-SNARK input type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>new_root</code></td><td>Public</td><td>An updated merkle root of the tree.</td></tr>
</tbody></table>
<h1><a class="header" href="#contract-api" id="contract-api">Contract API</a></h1>
<p>You can always get the latest version of the zkC.R.E.A.M. contract source code <a href="https://github.com/couger-inc/cream/blob/master/contracts/contracts/Cream.sol">here</a>.</p>
<h2><a class="header" href="#constructor" id="constructor">Constructor</a></h2>
<p>When you deploy the contract, you need to pass the following elements as arguments.</p>
<pre><code class="language-solidity">constructor(
    IVerifier _verifier,
    SignUpToken _signUpToken,
    uint256 _denomination,
    uint32 _merkleTreeHeight,
    address[] memory _recipients
)
</code></pre>
<h3><a class="header" href="#argument-details" id="argument-details">Argument details</a></h3>
<table><thead><tr><th>Argument</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_verifier</code></td><td><code>Verifier</code> contract address. This contract can be updated later with the <code>updateVerifer(address)</code> method.</td></tr>
<tr><td><code>_signUpToken</code></td><td><code>SignUpToken</code> contract address of the token to be used for voting.</td></tr>
<tr><td><code>_denomination</code></td><td>The total amount of tokens needed for the <code>deposit()</code> function call.</td></tr>
<tr><td><code>_merkleTreeHeight</code></td><td>Specify the size of the merkle tree for managing the history of deposits. The size of the tree is <code>2**N</code>.</td></tr>
<tr><td><code>_recipients</code></td><td>An array of ethereum addresses to be candidates for the ballot. These arrays are passed as an argument to the method <code>setRecipients()</code> when the contract is deployed, and cannot be changed after.</td></tr>
</tbody></table>
<h2><a class="header" href="#deposit-1" id="deposit-1">Deposit</a></h2>
<p>The call to the deposit function is a very simple process of passing a locally generated value, in this case <code>_commitment</code>, but you should not forget to send the value of <code>_denomination</code> and have a token from the <code>_signUpToken</code> token contract.</p>
<pre><code class="language-solidity">function deposit (
    bytes32 _commitment
)
</code></pre>
<h3><a class="header" href="#argument-details-1" id="argument-details-1">Argument details</a></h3>
<table><thead><tr><th>Argument</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_commitment</code></td><td>The value of a client-generated commitment. The function <code>pedersenHash(nullifier, secret)</code> is used to generate the value of this commitment.</td></tr>
</tbody></table>
<h3><a class="header" href="#usage-1" id="usage-1">Usage</a></h3>
<pre><code class="language-javascript">const instance = await Cream.deployed()
const tokenContract = await SignUpToken.deployed()

// setApprovalforall for token transfer
await tokenContract.giveToken(voter)
await tokenContract.setApprovalForAll(instance.address, true, { from: voter })

// deposit
const deposit = createDeposit(rbigInt(31), rbigInt(31))
const tx = await instance.deposit(toHex(deposit.commitment), { from: voter })
truffleAssert.eventEmitted(tx, 'Deposit')
</code></pre>
<h2><a class="header" href="#withdraw-1" id="withdraw-1">Withdraw</a></h2>
<pre><code class="language-solidity">function withdraw (
    bytes calldata _proof,
    bytes32 _root,
    bytes32 _nullifierHash,
    address payable _recipient,
    address payable _relayer,
    uint256 _fee
)
</code></pre>
<h3><a class="header" href="#argument-details-2" id="argument-details-2">Argument details</a></h3>
<table><thead><tr><th>Argument</th><th>Description</th></tr></thead><tbody>
<tr><td><code>_proof</code></td><td>A zk-SNARK proof.</td></tr>
<tr><td><code>_root</code></td><td>The value of the root hash of the Merkle Tree.</td></tr>
<tr><td><code>_nullifierHash</code></td><td>The value of <code>X</code> of <code>BabyJubJub</code> (see <a href="https://eips.ethereum.org/EIPS/eip-2494">here</a>) from the return value of <code>nullifier</code> = <code>ğ‘˜</code> passed to <code>pedersenHash()</code>.</td></tr>
<tr><td><code>_recipient</code></td><td>Candidate's Ethereum address. Passing an address other than the one specified in the constructor call will cause the transaction to be reverted.</td></tr>
<tr><td><code>_relayer</code></td><td>Relayer address.</td></tr>
<tr><td><code>_fee</code></td><td>Relayer fee.</td></tr>
</tbody></table>
<h3><a class="header" href="#usage-2" id="usage-2">Usage</a></h3>
<pre><code class="language-javascript">// Deposit
const deposit = createDeposit(rbigInt(31), rbigInt(31))
tree.insert(deposit.commitment)
await instance.deposit(toHex(deposit.commitment), { from: voter })

// Update tree
const root = tree.root
const merkleProof = tree.getPathUpdate(0)

// Create an input
const input = {
  root,
  nullifierHash: pedersenHash(deposit.nullifier.leInt2Buff(31)).babyJubX,
  relayer: relayer,
  recipient,
  fee,
  nullifier: deposit.nullifier,
  secret: deposit.secret,
  path_elements: merkleProof[0],
  path_index: merkleProof[1]
}

let isSpent = await instance.isSpent(toHex(input.nullifierHash))
assert.isFalse(isSpent)

const {
  proof,
} = await genProofAndPublicSignals(
  input,
  'prod/vote.circom',
  'build/vote.zkey',
  'circuits/vote.wasm'
)

const args = [
  toHex(input.root),
  toHex(input.nullifierHash),
  toHex(input.recipient, 20),
  toHex(input.relayer, 20),
  toHex(input.fee)
]

const proofForSolidityInput = toSolidityInput(proof)

// Create withdraw tx
const tx = await instance.withdraw(proofForSolidityInput, ...args, { from: relayer })

truffleAssert.eventEmitted(tx, 'Withdrawal')
</code></pre>
<h1><a class="header" href="#libcream" id="libcream">libcream</a></h1>
<h2><a class="header" href="#types" id="types">Types</a></h2>
<p><strong><code>SnarkBigint</code></strong></p>
<p>A big integer type compatible with the <code>cream-merkle-tree</code> <a href="https://github.com/kazuakiishiguro/cream-merkle-tree">library</a>. This type is ported from <code>snarkjs =&lt; 0.1.20</code> library.</p>
<h2><a class="header" href="#interfaces" id="interfaces">Interfaces</a></h2>
<p><strong><code>PedersenHash</code></strong></p>
<p>Encapsulates the outputs of the <code>pedersenHash()</code> function.</p>
<pre><code class="language-typescript">interface PedersenHash {
    babyJubX: SnarkBigInt,
    babyJubY: SnarkBigInt
}
</code></pre>
<p><strong><code>Deposit</code></strong></p>
<p>Encapsulates some of the information essential to create a Snark proof. It provides an output interface to the <code>createDeposit()</code> method.</p>
<pre><code class="language-typescript">interface Deposit {
    nullifier: SnarkBigInt,
    secret: SnarkBigInt,
    preimage: SnarkBigInt,
    commitment: SnarkBigInt,
    nullifierHash: SnarkBigInt
}
</code></pre>
<h2><a class="header" href="#functions" id="functions">Functions</a></h2>
<p><strong><code>pedersenHash</code></strong></p>
<p>Function to hash the given value and return a value of the type of the <code>PedersenHash</code> interface.</p>
<pre><code class="language-typescript">const pedersenHash (
	value: SnarkBigInt
): PedersenHash =&gt; {}
</code></pre>
<p><strong><code>createDeposit</code></strong></p>
<p>Function to return a value of the type of the <code>Deposit</code> interface given 2 values, nullifier and secret.</p>
<pre><code class="language-typescript">const createDeposit (
	nullifier: SnarkBigInt,
	secret: SnarkBigInt
): Deposit =&gt; {}
</code></pre>
<p><strong><code>createMessage</code></strong>
Function to return a value of the type of the <code>Message</code> interface and <code>PubKey</code>.</p>
<pre><code class="language-typescript">const createMessage(
	userStateIndex: number,
	userKeypair: Keypair,
	newUserKeypair: Keypair | null,
	coordinatorPubKey: PubKey,
	voteOptionIndex: number | null,
	voiceCredits: BigNumber | null,
	nonce: number,
	_salt?: BigInt
): [Message, PubKey] =&gt; {}
</code></pre>
<p><strong><code>generateDeposit</code></strong></p>
<p>Generates a type of the Deposit interface from a given string.</p>
<pre><code class="language-typescript">const generateDeposit (
	note: string
): Deposit =&gt; {}
</code></pre>
<p><strong><code>toHex</code></strong></p>
<p>Returns a string in hexadecimal format from the passed values and optionally specifies the length of the string (default <code>length = 32</code>).</p>
<pre><code class="language-typescript">const toHex (
	n: SnarkBigInt,
	length = 32
	): string =&gt; {}
</code></pre>
<p><strong><code>rbigInt</code></strong></p>
<p>Function to return a random integer of type <code>SnarkBigInt</code> for a given number of bytes.</p>
<pre><code class="language-typescript">const rbigInt = (
    nbytes: number
): SnarkBigInt =&gt; {}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
